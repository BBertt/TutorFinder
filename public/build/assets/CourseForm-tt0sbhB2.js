import{r as g,j as e,b as Y,u as B,H as G,a as W,R as J}from"./app-B27Fz-uK.js";import{L as K}from"./Layout-DjIRaP5W.js";import{V as ee}from"./VideoPlayer-D-8qS3wL.js";import{C as V}from"./ConfirmationModal-BwxtX91B.js";import"./GuestNavbar-B5bLSoHW.js";import"./SuccessModal-CP1VXOKE.js";function te({data:s,setData:d,errors:i,clearErrors:r,setFrontendErrors:a,course:y,categories:t,frontendErrors:p={}}){const[C,N]=g.useState(null),[c,m]=g.useState(""),[h,b]=g.useState(""),[k,z]=g.useState(""),[L,T]=g.useState(""),[F,U]=g.useState(""),[P,E]=g.useState(""),[I,A]=g.useState(""),[Q,n]=g.useState(""),[$,R]=g.useState(""),[o,x]=g.useState(""),[v,_]=g.useState(!1),q=g.useRef(null),M=u=>/^(https?:\/\/)?(www\.)?(youtube\.com\/watch\?v=|youtu\.be\/)[A-Za-z0-9_-]{11}(?:[&#?].*)?$/.test(u.trim()),l=u=>{try{const O=new URL(u);if(O.hostname.includes("youtu.be"))return O.pathname.slice(1);if(O.hostname.includes("youtube.com"))return O.searchParams.get("v")}catch{}const S=u.match(/(?:v=|youtu\.be\/)([A-Za-z0-9_-]{11})/);return S?S[1]:null};g.useEffect(()=>{!s.thumbnail_image&&y?.thumbnail_image_url&&N(y.thumbnail_image_url),y?.intro_video_url&&m(y.intro_video_url)},[y]),g.useEffect(()=>{function u(S){if(q.current&&!q.current.contains(S.target)&&(_(!1),!t.find(X=>X.name.toLowerCase()===o.toLowerCase())))if(!s.category_id)x("");else{const X=t.find(H=>H.id===s.category_id);X&&x(X.name)}}return document.addEventListener("mousedown",u),()=>{document.removeEventListener("mousedown",u)}},[q,o,s.category_id,t]);const f=o===""?t:t.filter(u=>u.name.toLowerCase().replace(/\s+/g,"").includes(o.toLowerCase().replace(/\s+/g,""))),j=(u,S,O)=>{const X=u.target.files[0];X&&(d(S,X),O(URL.createObjectURL(X)),errorSetter(""),r&&r(S),a&&a({}))},w=(u,S,O,X)=>{d(u,S),r&&r(u),a&&a({}),O(S?"":X)},D=!c||M(c);return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6 mt-8","data-intro-video-valid":D,children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium dark:text-white",children:"Title"}),e.jsx("input",{type:"text",id:"title",placeholder:"Input your course title here...",value:s.title,onChange:u=>w("title",u.target.value,b,"The title field is required."),className:"mt-1 block w-full border-gray-200 rounded-md shadow-sm dark:bg-darkSecondary dark:border-dark dark:text-white dark:placeholder-gray-400"}),(h||i.title||p.title)&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:h||i.title||p.title})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-black dark:text-white",children:"Description"}),e.jsx("textarea",{id:"description",placeholder:"Input your course description here...",value:s.description,onChange:u=>w("description",u.target.value,z,"The description field is required."),rows:"5",className:"mt-1 block w-full border-gray-200 rounded-md shadow-sm dark:bg-darkSecondary dark:border-dark dark:text-white dark:placeholder-gray-400"}),(k||i.description||p.description)&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:k||i.description||p.description})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"student_outcome",className:"block text-sm font-medium text-black dark:text-white",children:"What will they learn"}),e.jsx("textarea",{id:"student_outcome",placeholder:"Input what students will learn here...",value:s.student_outcome,onChange:u=>w("student_outcome",u.target.value,T,"The 'What will they learn' field is required."),rows:"5",className:"mt-1 block w-full border-gray-200 rounded-md shadow-sm dark:bg-darkSecondary dark:border-dark dark:text-white dark:placeholder-gray-400"}),(L||i.student_outcome||p.student_outcome)&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:L||i.student_outcome||p.student_outcome})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"requirements",className:"block text-sm font-medium dark:text-white",children:"Requirements"}),e.jsx("textarea",{id:"requirements",placeholder:"Input course requirements here...",value:s.requirements,onChange:u=>w("requirements",u.target.value,U,"The requirements field is required."),rows:"5",className:"mt-1 block w-full border-gray-200 rounded-md shadow-sm dark:bg-darkSecondary dark:border-dark dark:text-white dark:placeholder-gray-400"}),(F||i.requirements||p.requirements)&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:F||i.requirements||p.requirements})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium dark:text-white",children:"Featured Image"}),e.jsx("input",{type:"file",id:"thumbnail_image",accept:"image/*",onChange:u=>j(u,"thumbnail_image",N),className:"hidden"}),e.jsx("label",{htmlFor:"thumbnail_image",className:"mt-1 w-full h-48 border-2 border-dashed border-gray-200 rounded-lg flex items-center justify-center cursor-pointer hover:border-primary dark:bg-darkSecondary dark:border-dark dark:hover:border-primary",children:C?e.jsx("img",{src:C,alt:"Thumbnail Preview",className:"max-h-full max-w-full object-contain"}):e.jsx("span",{className:"text-center text-gray-400",children:"Click to upload image"})}),(P||i.thumbnail_image||p.thumbnail_image)&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:P||i.thumbnail_image||p.thumbnail_image})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-black dark:text-white",children:"Intro Video (YouTube URL)"}),e.jsx("input",{type:"url",inputMode:"url",placeholder:"https://www.youtube.com/watch?v=XXXXXXXXXXX",value:c,onChange:u=>{const S=u.target.value;m(S),d("intro_video",S),r&&r("intro_video"),a&&a({}),!S||M(S)?A(""):A("Please enter a valid YouTube URL")},className:"mt-1 block w-full border-gray-200 rounded-md shadow-sm dark:bg-darkSecondary dark:border-dark dark:text-white dark:placeholder-gray-400"}),c&&M(c)&&e.jsx("div",{className:"mt-3 aspect-video w-full",children:e.jsx(ee,{videoUrl:`https://www.youtube.com/embed/${l(c)}`,className:"h-1/2"})}),(I||i.intro_video||p.intro_video)&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:I||i.intro_video||p.intro_video})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"price",className:"block text-sm font-medium dark:text-white",children:"Price (Rp)"}),e.jsx("input",{type:"number",id:"price",value:s.price,onChange:u=>w("price",u.target.value,n,"The price field is required."),className:"mt-1 block w-full border-gray-200 rounded-md shadow-sm dark:bg-darkSecondary dark:border-dark dark:text-white dark:placeholder-gray-400"}),(Q||i.price||p.price)&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:Q||i.price||p.price})]}),e.jsxs("div",{ref:q,className:"relative",children:[e.jsx("label",{htmlFor:"category_id",className:"block text-sm font-medium dark:text-white",children:"Category"}),e.jsx("input",{id:"category_id",type:"text",value:o,onFocus:()=>_(!0),onChange:u=>{x(u.target.value),r&&r("category_id"),a&&a({}),R(""),d("category_id","")},placeholder:"Search or select a category",autoComplete:"off",className:"mt-1 block w-full border-gray-200 rounded-md shadow-sm dark:bg-darkSecondary dark:border-dark dark:text-white dark:placeholder-gray-400"}),v&&e.jsx("ul",{className:"absolute z-10 w-full mt-1 bg-white dark:bg-darkSecondary border border-gray-300 dark:border-dark rounded-md shadow-lg max-h-60 overflow-auto",children:f.length>0?f.map(u=>e.jsx("li",{onClick:()=>{x(u.name),d("category_id",u.id),_(!1),R("")},className:"px-4 py-2 text-gray-900 dark:text-gray-200 hover:bg-primary hover:text-white dark:hover:bg-primary cursor-pointer",children:u.name},u.id)):e.jsx("li",{className:"px-4 py-2 text-gray-500 dark:text-gray-400",children:"No categories found."})}),($||i.category_id||p.category_id)&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:s.category_id?i.category_id||p.category_id:$||"Please select a valid category."})]})]})]})}function Z({value:s,onChange:d}){const i=s||{title:"",questions:[]},r=m=>{const h=typeof m=="function"?m(i):m;d(h)},a=()=>{r({...i,questions:[...i.questions||[],{question:"",options:[{option:"",is_correct:!1}]}]})},y=m=>{r({...i,questions:i.questions.filter((h,b)=>b!==m)})},t=(m,h)=>{r({...i,questions:i.questions.map((b,k)=>k===m?{...b,question:h}:b)})},p=m=>{r({...i,questions:i.questions.map((h,b)=>b===m?{...h,options:[...h.options||[],{option:"",is_correct:!1}]}:h)})},C=(m,h)=>{r({...i,questions:i.questions.map((b,k)=>k===m?{...b,options:b.options.filter((z,L)=>L!==h)}:b)})},N=(m,h,b)=>{r({...i,questions:i.questions.map((k,z)=>z===m?{...k,options:k.options.map((L,T)=>T===h?{...L,option:b}:L)}:k)})},c=(m,h)=>{r({...i,questions:i.questions.map((b,k)=>k===m?{...b,options:b.options.map((z,L)=>({...z,is_correct:L===h}))}:b)})};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-md font-semibold",children:"Quiz Questions"}),e.jsx("button",{type:"button",onClick:a,className:"px-2 py-1 text-sm bg-primary text-white rounded-md",children:"+ Add Question"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Quiz Duration (minutes)"}),e.jsx("input",{type:"number",min:"1",step:"1",value:Math.max(1,Math.round((i.duration_seconds||900)/60)),onChange:m=>{const h=parseInt(m.target.value||"0",10);r({...i,duration_seconds:Math.max(1,h)*60})},className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Students must finish within this time."})]})}),(i.questions||[]).length===0&&e.jsx("p",{className:"text-sm text-gray-500",children:"No questions yet."}),(i.questions||[]).map((m,h)=>e.jsxs("div",{className:"border rounded-md p-3 space-y-2",children:[e.jsxs("div",{className:"flex gap-2 items-start",children:[e.jsx("input",{type:"text",value:m.question||"",onChange:b=>t(h,b.target.value),placeholder:`Question ${h+1}`,className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400"}),e.jsx("button",{type:"button",onClick:()=>y(h),className:"text-red-600 text-sm font-semibold",children:"Remove"})]}),e.jsxs("div",{className:"pl-2 space-y-2",children:[(m.options||[]).map((b,k)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:`q_${h}_correct`,checked:!!b.is_correct,onChange:()=>c(h,k),className:"border-gray-300 shadow-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400"}),e.jsx("input",{type:"text",value:b.option||"",onChange:z=>N(h,k,z.target.value),placeholder:`Option ${k+1}`,className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400"}),e.jsx("button",{type:"button",onClick:()=>C(h,k),className:"text-xs text-red-600 font-semibold",children:"Delete"})]},k)),e.jsx("button",{type:"button",onClick:()=>p(h),className:"text-sm text-primary font-semibold",children:"+ Add Option"})]})]},h))]})}function se({section:s,isOpen:d,onClose:i,onSave:r}){const{data:a,setData:y,processing:t,reset:p}=Y({title:"",description:"",video_url:""}),C=c=>/^(https?:\/\/)?(www\.)?(youtube\.com\/watch\?v=|youtu\.be\/)[A-Za-z0-9_-]{11}(?:[&#?].*)?$/.test((c||"").trim()),N=c=>{if(c.preventDefault(),a.video_url&&!C(a.video_url))return;const m={id:`temp_lesson_${Date.now()}`,...a};r(s.id,m),p(),i()};return d?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl dark:bg-gray-800",children:e.jsxs("form",{onSubmit:N,className:"p-6",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-4 dark:text-gray-200",children:['Add New Lesson to "',s.title,'"']}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"lesson_title",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Name"}),e.jsx("input",{id:"lesson_title",type:"text",value:a.title,onChange:c=>y("title",c.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400",placeholder:"Enter Lesson Name"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"lesson_description",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Content"}),e.jsx("textarea",{id:"lesson_description",value:a.description,onChange:c=>y("description",c.target.value),rows:"4",className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400",placeholder:"Enter Lesson Content/Description"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"lesson_video_url",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"YouTube Video URL (Optional)"}),e.jsx("input",{type:"url",id:"lesson_video_url",placeholder:"https://www.youtube.com/watch?v=XXXXXXXXXXX",value:a.video_url,onChange:c=>y("video_url",c.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{type:"button",onClick:i,className:"px-4 py-2 rounded-lg text-gray-700 bg-gray-200 hover:bg-gray-300 font-semibold dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded-lg bg-primary text-white font-semibold hover:bg-opacity-80 dark:hover:bg-opacity-80",disabled:t,children:t?"Saving...":"Ok"})]})]})})}):null}function ie({section:s,isOpen:d,onClose:i,onSave:r}){const{data:a,setData:y,processing:t,reset:p}=Y({id:"",title:"",description:""});g.useEffect(()=>{s&&y({id:s.id,title:s.title,description:s.description||""})},[s]);const C=N=>{N.preventDefault();const c={...s,...a};r(c),p(),i()};return d?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl dark:bg-gray-800",children:e.jsxs("form",{onSubmit:C,className:"p-6 space-y-4",children:[e.jsx("h2",{className:"text-2xl font-bold dark:text-gray-200",children:"Edit Section Details"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"section_title",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Title"}),e.jsx("input",{id:"section_title",type:"text",value:a.title,onChange:N=>y("title",N.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"section_description",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Description (Optional)"}),e.jsx("textarea",{id:"section_description",value:a.description,onChange:N=>y("description",N.target.value),rows:"3",className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400"})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx("button",{type:"button",onClick:i,className:"px-4 py-2 rounded-lg text-gray-700 bg-gray-200 hover:bg-gray-300 font-semibold dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded-lg bg-primary text-white font-semibold hover:bg-opacity-80 dark:hover:bg-opacity-80",disabled:t,children:t?"Saving...":"Ok"})]})]})})}):null}function ae({lessonData:s,isOpen:d,onClose:i,onSave:r}){const{data:a,setData:y,processing:t,reset:p}=Y({id:"",title:"",description:"",video_url:""});g.useEffect(()=>{s?.lesson&&y({id:s.lesson.id,title:s.lesson.title,description:s.lesson.description,video_url:s.lesson.video_url||""})},[s]);const C=c=>/^(https?:\/\/)?(www\.)?(youtube\.com\/watch\?v=|youtu\.be\/)[A-Za-z0-9_-]{11}(?:[&#?].*)?$/.test((c||"").trim()),N=c=>{if(c.preventDefault(),a.video_url&&!C(a.video_url))return;const m={...s.lesson,...a};r(m),p(),i()};return d?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl dark:bg-gray-800",children:e.jsxs("form",{onSubmit:N,className:"p-6",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-4 dark:text-gray-200",children:["Edit Lesson: ",s.lesson.title]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"edit_lesson_title",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Name"}),e.jsx("input",{id:"edit_lesson_title",type:"text",value:a.title,onChange:c=>y("title",c.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"edit_lesson_description",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Content"}),e.jsx("textarea",{id:"edit_lesson_description",value:a.description,onChange:c=>y("description",c.target.value),rows:"4",className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"edit_lesson_video_url",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"YouTube Video URL (Optional)"}),e.jsx("input",{type:"url",id:"edit_lesson_video_url",placeholder:"https://www.youtube.com/watch?v=XXXXXXXXXXX",value:a.video_url,onChange:c=>y("video_url",c.target.value),className:`mt-1 block w-full border rounded-md shadow-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400 ${a.video_url&&!C(a.video_url)?"border-red-500":"border-gray-300"}`}),a.video_url&&!C(a.video_url)&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:"Invalid YouTube URL."}),a.video_url&&C(a.video_url)&&e.jsx("div",{className:"mt-3 aspect-video w-full",children:e.jsx("iframe",{className:"w-full h-full rounded",src:`https://www.youtube.com/embed/${a.video_url.match(/(?:v=|youtu\.be\/)([A-Za-z0-9_-]{11})/)?.[1]}`,title:"Lesson Video Preview",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowFullScreen:!0})})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{type:"button",onClick:i,className:"px-4 py-2 rounded-lg text-gray-700 bg-gray-200 hover:bg-gray-300 font-semibold dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded-lg bg-primary text-white font-semibold hover:bg-opacity-80 dark:hover:bg-opacity-80",disabled:t,children:t?"Saving...":"Ok"})]})]})})}):null}function re({sections:s,setData:d,errors:i,frontendErrors:r={},finalQuizTitle:a,finalQuiz:y,onFinalQuizTitleChange:t,onFinalQuizChange:p}){const[C,N]=g.useState(!1),[c,m]=g.useState(!1),[h,b]=g.useState(!1),[k,z]=g.useState(null),[L,T]=g.useState(null),[F,U]=g.useState(""),[P,E]=g.useState(""),[I,A]=g.useState(!1),[Q,n]=g.useState(null),$=(l,f)=>{l==="addLesson"?(z(f),N(!0)):l==="editSection"?(z(f),m(!0)):l==="editLesson"&&(T(f),b(!0))},R=()=>{N(!1),m(!1),b(!1)},o=l=>{if(l.preventDefault(),F.trim()==="")return;const f={id:`temp_${Date.now()}`,title:F,description:P,lessons:[]};d("sections",[...s,f]),U(""),E("")},x=l=>{d("sections",s.map(f=>f.id===l.id||f.id===l.temp_id?l:f))},v=(l,f,j=null)=>{n({type:l,sectionId:f,lessonId:j}),A(!0)},_=()=>{if(!Q)return;const{type:l,sectionId:f,lessonId:j}=Q;l==="section"?d("sections",s.filter(w=>w.id!==f)):l==="lesson"&&d("sections",s.map(w=>w.id===f?{...w,lessons:w.lessons.filter(D=>D.id!==j)}:w)),A(!1),n(null)},q=(l,f)=>{d("sections",s.map(j=>j.id===l?{...j,lessons:[...j.lessons,f]}:j))},M=l=>{d("sections",s.map(f=>({...f,lessons:f.lessons.map(j=>j.id===l.id||j.id===l.temp_id?l:j)})))};return e.jsxs(e.Fragment,{children:[e.jsx(se,{isOpen:C,section:k,onClose:R,onSave:q}),e.jsx(ie,{isOpen:c,section:k,onClose:R,onSave:x}),e.jsx(ae,{isOpen:h,lessonData:L,onClose:R,onSave:M}),e.jsx(V,{isOpen:I,onClose:()=>A(!1),onConfirm:_,title:"Confirm Deletion",message:"Are you sure you want to delete this? This action cannot be undone.",confirmText:"Yes, Delete",cancelText:"No",confirmColor:"bg-red-600"}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 dark:text-white",children:"Sections & Lessons"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"Structure your course by adding sections and the lessons within them."}),(r.sections_min||r.lessons_min||r.lesson_content)&&e.jsxs("div",{className:"p-4 mb-4 text-sm text-red-800 rounded-lg bg-red-100 border border-red-300 dark:bg-red-900 dark:text-red-300 dark:border-red-700",children:[r.sections_min&&e.jsx("p",{children:r.sections_min}),r.lessons_min&&e.jsx("p",{children:r.lessons_min}),r.lesson_content&&e.jsx("p",{children:r.lesson_content})]}),e.jsxs("div",{className:"space-y-4 mb-8",children:[s.map((l,f)=>e.jsxs("div",{className:"p-4 border rounded-lg dark:bg-darkSecondary dark:border-dark",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-lg dark:text-white",children:["Section ",f+1,": ",l.title]}),l.description&&e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:l.description})]}),e.jsxs("div",{className:"flex items-center space-x-2 flex-shrink-0",children:[e.jsx("button",{type:"button",onClick:()=>$("editSection",l),className:"px-4 py-1 text-sm bg-gray-200 font-semibold rounded-md hover:bg-gray-300 dark:bg-gray-700 dark:text-white dark:hover:bg-gray-600",children:"Edit"}),e.jsx("button",{type:"button",onClick:()=>v("section",l.id),className:"px-4 py-1 text-sm bg-red-600 text-white font-semibold rounded-md hover:bg-red-700 dark:hover:bg-red-500",children:"Delete"})]})]}),e.jsxs("div",{className:"pl-6 mt-4 border-l-2 dark:border-l-gray-700 space-y-2",children:[l.lessons.map(j=>e.jsxs("div",{className:"text-sm dark:text-white flex justify-between items-center",children:[e.jsxs("span",{children:["- ",j.title]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{type:"button",onClick:()=>$("editLesson",{lesson:j,section:l}),className:"text-blue-500 dark:text-blue-400 text-xs font-semibold",children:"Edit"}),e.jsx("button",{type:"button",onClick:()=>v("lesson",l.id,j.id),className:"text-red-500 dark:text-red-400 text-xs font-semibold",children:"Delete"})]})]},j.id)),l.lessons.length===0&&e.jsx("p",{className:"text-sm text-gray-400 italic",children:"No lessons in this section yet."}),e.jsxs("div",{className:"mt-3 flex flex-col gap-2",children:[e.jsx("button",{type:"button",onClick:()=>$("addLesson",l),className:"text-sm font-semibold text-primary hover:underline",children:"+ Add Lesson"}),e.jsx("input",{type:"text",value:l.quiz?.title||l.quiz_title||"",onChange:j=>d("sections",s.map(w=>w.id===l.id?{...w,quiz:{...w.quiz||{},title:j.target.value,questions:w.quiz?.questions||[]}}:w)),placeholder:"Optional Section Quiz Title",className:"text-sm w-full border-gray-300 rounded-md shadow-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400"}),(l.quiz?.title||l.quiz_title)&&e.jsx("div",{className:"mt-2",children:e.jsx(Z,{value:l.quiz,onChange:j=>d("sections",s.map(w=>w.id===l.id?{...w,quiz:j}:w))})})]})]})]},l.id)),s.length===0&&e.jsxs("div",{className:"text-center py-12 border-2 border-dashed rounded-lg dark:border-dark",children:[e.jsx("h3",{className:"text-xl font-bold dark:text-white",children:"Your course has no sections"}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Add your first section below to get started."})]})]}),e.jsxs("form",{onSubmit:o,className:"space-y-4 border-t pt-6 dark:border-t-gray-700",children:[e.jsxs("div",{children:[e.jsx("input",{type:"text",value:F,onChange:l=>U(l.target.value),placeholder:"Add a new section title...",className:"w-full border-gray-200 rounded-md shadow-sm dark:bg-darkSecondary dark:border-dark dark:text-white dark:placeholder-gray-400"}),i["sections.0.title"]&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:"Section titles are required."})]}),e.jsx("div",{children:e.jsx("textarea",{value:P,onChange:l=>E(l.target.value),placeholder:"Add an optional description for the section...",rows:"2",className:"w-full border-gray-200 rounded-md shadow-sm dark:bg-darkSecondary dark:border-dark dark:text-white dark:placeholder-gray-400"})}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",className:"px-4 py-2 bg-primary text-white rounded-md font-semibold dark:hover:bg-opacity-80",children:"Add Section"})})]}),e.jsx("div",{className:"mt-10",children:e.jsxs("div",{className:"mb-6 p-4 border rounded-lg bg-gray-50 dark:bg-gray-800 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3 dark:text-gray-200",children:"Final Quiz (Optional)"}),e.jsx("input",{type:"text",value:a||"",onChange:l=>t&&t(l.target.value),placeholder:"Enter a final quiz title or leave blank",className:"w-full border-gray-300 rounded-md shadow-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400"}),a?e.jsx("div",{className:"mt-3",children:e.jsx(Z,{value:y,onChange:p})}):null,e.jsx("p",{className:"text-xs text-gray-500 mt-1 dark:text-gray-400",children:"If provided, a final quiz will be created for the whole course."})]})})]})]})}function le({courseData:s,existingCourse:d}){return e.jsxs("div",{className:"mt-8 dark:text-gray-100",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 dark:text-white",children:"Review and Publish"}),e.jsx("p",{className:"text-gray-400 dark:text-gray-400 mb-6",children:'This is a preview of the data that will be saved. Once you are satisfied, click "Publish" or "Save to Draft".'}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border space-y-8 dark:bg-darkSecondary dark:border-dark",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-8 items-start",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold dark:text-white",children:s.title||"(No Title)"}),e.jsx("p",{className:"mt-4 dark:text-white",children:s.description||"(No Description)"})]}),e.jsx("div",{className:"flex justify-center md:justify-end",children:s.thumbnail_image?e.jsx("img",{src:URL.createObjectURL(s.thumbnail_image),alt:"Thumbnail Preview",className:"rounded-lg shadow-md w-full max-w-sm"}):d?.thumbnail_image_url&&e.jsx("img",{src:d.thumbnail_image_url,alt:"Thumbnail Preview",className:"rounded-lg shadow-md w-full max-w-sm"})})]}),e.jsx("hr",{className:"dark:border-dark"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold mb-4 dark:text-white",children:"What You'll Learn"}),e.jsx("div",{className:"prose prose-sm max-w-none text-gray-700 dark:text-gray-300 whitespace-pre-line",children:s.student_outcome||"(Not specified)"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold mb-4 dark:text-white",children:"Requirements"}),e.jsx("div",{className:"prose prose-sm max-w-none text-gray-700 dark:text-gray-300 whitespace-pre-line",children:s.requirements||"(Not specified)"})]})]}),e.jsx("hr",{className:"dark:border-dark"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold mb-4 dark:text-white",children:"Sections & Lessons"}),e.jsxs("div",{className:"space-y-4",children:[s.sections.map((i,r)=>e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold dark:text-white",children:["Section ",r+1,": ",i.title]}),i.description&&e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-400 mt-1",children:i.description}),e.jsxs("ul",{className:"list-disc list-inside pl-4 dark:text-white",children:[i.lessons.map(a=>e.jsx("li",{children:a.title},a.id)),i.lessons.length===0&&e.jsx("li",{className:"text-gray-400 dark:text-gray-400 italic",children:"No lessons in this section yet."})]})]},i.id)),s.sections.length===0&&e.jsx("p",{className:"text-gray-400 dark:text-gray-400 italic",children:"No sections or lessons have been added yet."})]})]})]})]})}const de=({currentStep:s})=>{const d=["Overview","Sections & Lessons","Review"];return e.jsx("div",{className:"flex items-center justify-center",children:d.map((i,r)=>e.jsxs(J.Fragment,{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold transition-colors ${r+1<=s?"bg-primary text-white":"bg-gray-200 text-gray-400 dark:bg-gray-700 dark:text-gray-400"}`,children:r+1}),e.jsx("p",{className:`ml-2 transition-colors ${r+1<=s?"text-primary font-semibold":"text-gray-400"}`,children:i})]}),r<d.length-1&&e.jsx("div",{className:`flex-auto border-t-2 transition-colors mx-4 ${r+1<s?"border-primary":"border-gray-200 dark:border-dark"}`})]},r))})};function oe({categories:s}){const{course:d,flash:i}=B().props,r=!!d,[a,y]=g.useState(()=>r&&i.from_create?2:1),{data:t,setData:p,errors:C,clearErrors:N}=Y({title:d?.title||"",description:d?.description||"",student_outcome:d?.student_outcome||"",requirements:d?.requirements||"",price:d?.price||"",category_id:d?.category_id||"",thumbnail_image:null,intro_video:null,sections:(d?.sections||[]).map(n=>({...n,quiz_title:n.quiz?.title||n.quiz_title||""})),final_quiz_title:d?.finalQuiz?.title||"",final_quiz:d?.finalQuiz||{title:d?.finalQuiz?.title||"",questions:[]},status:d?.status||"draft"}),[c,m]=g.useState(!1),[h,b]=g.useState(!1),[k,z]=g.useState(!1),[L,T]=g.useState({}),F=(n,$)=>{n.preventDefault(),m(!0),N(),T({});const R=r?route("tutor.courses.update",d.id):route("tutor.courses.store"),o=new FormData;o.append("title",t.title),o.append("description",t.description),o.append("student_outcome",t.student_outcome),o.append("requirements",t.requirements),o.append("price",t.price),o.append("category_id",t.category_id),o.append("status",$),t.thumbnail_image instanceof File&&o.append("thumbnail_image",t.thumbnail_image),t.intro_video instanceof File&&o.append("intro_video",t.intro_video),t.intro_video&&!(t.intro_video instanceof File)&&o.append("intro_video",t.intro_video),t.sections.length>0&&t.sections.forEach((x,v)=>{o.append(`sections[${v}][id]`,x.id||""),o.append(`sections[${v}][quiz_title]`,x.quiz&&x.quiz.title||x.quiz_title||""),x.quiz&&(x.quiz.title||x.quiz_title)&&o.append(`sections[${v}][quiz_duration_seconds]`,String(x.quiz?.duration_seconds??900)),x.quiz&&Array.isArray(x.quiz.questions)&&x.quiz.questions.forEach((_,q)=>{o.append(`sections[${v}][quiz][questions][${q}][question]`,_.question||""),(_.options||[]).forEach((M,l)=>{o.append(`sections[${v}][quiz][questions][${q}][options][${l}][option]`,M.option||""),o.append(`sections[${v}][quiz][questions][${q}][options][${l}][is_correct]`,M.is_correct?"1":"0")})}),o.append(`sections[${v}][title]`,x.title),o.append(`sections[${v}][description]`,x.description||""),!x.lessons||x.lessons.length===0?o.append(`sections[${v}][lessons]`,""):x.lessons.forEach((_,q)=>{o.append(`sections[${v}][lessons][${q}][id]`,_.id||""),o.append(`sections[${v}][lessons][${q}][title]`,_.title),o.append(`sections[${v}][lessons][${q}][description]`,_.description),_.video instanceof File&&o.append(`sections[${v}][lessons][${q}][video]`,_.video),_.video_url&&o.append(`sections[${v}][lessons][${q}][video_url]`,_.video_url)})}),o.append("final_quiz_title",t.final_quiz_title||""),t.final_quiz_title&&o.append("final_quiz_duration_seconds",String(t.final_quiz?.duration_seconds??900)),t.final_quiz&&Array.isArray(t.final_quiz.questions)&&t.final_quiz.questions.forEach((x,v)=>{o.append(`final_quiz[questions][${v}][question]`,x.question||""),(x.options||[]).forEach((_,q)=>{o.append(`final_quiz[questions][${v}][options][${q}][option]`,_.option||""),o.append(`final_quiz[questions][${v}][options][${q}][is_correct]`,_.is_correct?"1":"0")})}),r&&o.append("_method","patch"),W.post(R,o,{onFinish:()=>m(!1),onError:x=>{console.log("Submission Errors:",x)}})},U=n=>F(n,"published"),P=n=>F(n,"draft"),E=()=>{W.get(route("tutor.courses.index"))},I=()=>{const n={};t.title||(n.title="The title field is required."),t.description||(n.description="The description field is required."),t.student_outcome||(n.student_outcome="The 'What will they learn' field is required."),t.requirements||(n.requirements="The requirements field is required."),!t.price&&t.price!==0&&(n.price="The price field is required."),t.category_id||(n.category_id="The category field is required."),t.intro_video||(n.intro_video="The introduction video field is required."),!r&&!t.thumbnail_image&&!d?.thumbnail_image_url&&(n.thumbnail_image="The thumbnail image is required.");const $=/^(https?:\/\/)?(www\.)?(youtube\.com\/watch\?v=|youtu\.be\/)[A-Za-z0-9_-]{11}(?:[&#?].*)?$/;return t.intro_video&&!(t.intro_video instanceof File)&&t.intro_video.trim()!==""&&!$.test(String(t.intro_video).trim())&&(n.intro_video="Please enter a valid YouTube URL."),T(n),Object.keys(n).length===0},A=()=>{const n={};return!t.sections||t.sections.length===0?n.sections_min="You must add at least one section.":(t.sections.some(o=>o.lessons.length===0)&&(n.lessons_min="Every section must have at least one lesson."),t.sections.some(o=>o.lessons.some(x=>!x.title||!x.description))&&(n.lesson_content="All lessons must have both a title and description.")),T(n),Object.keys(n).length===0},Q=()=>{N(),T({}),a===1?I()&&y(2):a===2&&A()&&y(3)};return e.jsxs(e.Fragment,{children:[e.jsx(G,{title:r?`Edit: ${d.title}`:"Create Course"}),e.jsx("div",{className:"bg-primary",children:e.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-xl font-bold text-white",children:r?d.title:"New Course"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{type:"button",onClick:()=>b(!0),className:"px-4 py-2 rounded-lg bg-white hover:bg-gray-400 font-semibold dark:bg-darkPrimary dark:hover:bg-gray-700",disabled:c,children:"Cancel"}),e.jsx("button",{type:"button",onClick:P,className:"px-4 py-2 rounded-lg bg-secondary text-white font-semibold hover:bg-gray-700 dark:hover:bg-gray-400",disabled:c,children:r?"Save Changes":"Save to Draft"})]})]})})}),e.jsxs("main",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-md border dark:bg-darkSecondary dark:border-dark",children:[e.jsx(de,{currentStep:a}),e.jsx("div",{className:a===1?"block":"hidden",children:e.jsx(te,{data:t,setData:p,errors:C,course:d,categories:s,clearErrors:N,setFrontendErrors:T,frontendErrors:L})}),e.jsx("div",{className:a===2?"block":"hidden",children:e.jsx(re,{sections:t.sections,setData:p,errors:C,frontendErrors:L,finalQuizTitle:t.final_quiz_title,finalQuiz:t.final_quiz,onFinalQuizTitleChange:n=>{p("final_quiz_title",n),p("final_quiz",{...t.final_quiz||{},title:n,questions:t.final_quiz?.questions||[]})},onFinalQuizChange:n=>p("final_quiz",n)})}),e.jsx("div",{className:a===3?"block":"hidden",children:e.jsx(le,{courseData:t,existingCourse:d})})]}),e.jsxs("div",{className:"flex justify-between mt-8",children:[e.jsx("button",{type:"button",onClick:()=>y(n=>Math.max(1,n-1)),disabled:a===1||c,className:"px-6 py-2 rounded-lg bg-gray-200 font-semibold disabled:opacity-50 dark:bg-darkSecondary dark:text-white dark:disabled:opacity-50",children:"Previous"}),a<3&&e.jsx("button",{type:"button",onClick:Q,disabled:c,className:"px-6 py-2 rounded-lg bg-primary text-white font-semibold disabled:opacity-50 dark:hover:bg-opacity-80",children:"Next"}),a===3&&t.status==="draft"&&e.jsx("button",{type:"button",onClick:()=>z(!0),className:"px-6 py-2 rounded-lg bg-primary text-white font-semibold hover:bg-opacity-80",disabled:c,children:"Publish"})]})]}),e.jsx(V,{isOpen:h,onClose:()=>b(!1),onConfirm:E,title:"Confirm Cancel",message:"Are you sure you want to cancel? Any unsaved changes will be lost.",confirmText:"Yes, Cancel",cancelText:"No",confirmColor:"bg-red-600"}),e.jsx(V,{isOpen:k,onClose:()=>z(!1),onConfirm:n=>{U(n),z(!1)},title:"Confirm Publish",message:"Are you sure you want to publish this course? It will become visible to students.",confirmText:"Yes, Publish",cancelText:"No"})]})}oe.layout=s=>e.jsx(K,{children:s});export{oe as default};
