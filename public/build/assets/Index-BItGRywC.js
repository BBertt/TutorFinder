import{u as S,r,c as m,j as s,a as C}from"./app-B27Fz-uK.js";import{L as M}from"./Layout-DjIRaP5W.js";import{C as _}from"./ConfirmationModal-BwxtX91B.js";import"./GuestNavbar-B5bLSoHW.js";import"./SuccessModal-CP1VXOKE.js";const T=({contacts:p,receiver:t,messages:n})=>{const{auth:o}=S().props,[f,l]=r.useState(n),[d,x]=r.useState(""),[y,u]=r.useState(!1),[i,g]=r.useState(null);r.useEffect(()=>{l(n)},[n]),r.useEffect(()=>{if(!t)return;const e=setInterval(async()=>{try{const{data:a}=await m.get(route("chat.getMessages",{receiver:t.id}));l(a)}catch{}},4e3);return()=>clearInterval(e)},[t]);const b=e=>{C.get(route("chat.show",{receiver:e}),{},{preserveState:!0,preserveScroll:!0,only:["receiver","messages"]})},j=e=>{g(e),u(!0)},h=()=>{g(null),u(!1)},v=async()=>{if(i)try{await m.delete(route("chat.destroy",{message:i})),l(e=>e.filter(a=>a.id!==i))}catch(e){console.error("Failed to delete message:",e)}finally{h()}},w=async e=>{if(e.preventDefault(),d.trim()===""||!t)return;const a={id:Date.now(),message:d,sender_id:o.user.id,created_at:new Date().toISOString()};l(c=>[...c,a]),x("");try{await m.post(route("chat.store",{receiver:t.id}),{message:d})}catch(c){console.error("Failed to send message:",c),l(N=>N.filter(k=>k.id!==a.id))}};return s.jsx(M,{children:s.jsxs("div",{className:"container mx-auto py-8",children:[s.jsxs("div",{className:"flex border border-gray-200 rounded-lg shadow-lg",style:{height:"calc(100vh - 220px)"},children:[s.jsxs("div",{className:"w-1/4 border-r border-gray-200 flex flex-col",children:[s.jsx("div",{className:"p-4 font-bold text-lg border-b border-gray-200",children:"Contacts"}),s.jsx("ul",{className:"flex-1 overflow-y-auto",children:p.map(e=>s.jsxs("li",{className:`p-4 cursor-pointer rounded-md transition-colors ${t?.id===e.id?"bg-gray-200 font-semibold dark:bg-darkSecondary dark:text-white":"hover:bg-gray-200 dark:hover:bg-darkSecondary text-gray-400"}`,onClick:()=>b(e.id),children:[e.first_name," ",e.last_name]},e.id))})]}),s.jsx("div",{className:"w-3/4 flex flex-col bg-white dark:bg-darkPrimary",children:t?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"p-4 font-bold text-lg border-b border-gray-200 dark:bg-darkPrimary",children:["Chat with ",t.first_name," ",t.last_name]}),s.jsx("div",{className:"flex-1 p-4 overflow-y-auto",children:f.map((e,a)=>s.jsxs("div",{className:`flex mb-3 ${e.sender_id===o.user.id?"justify-end":"justify-start"}`,children:[s.jsxs("div",{className:`max-w-md p-3 rounded-xl shadow-md ${e.sender_id===o.user.id?"bg-primary text-white":"bg-gray-200 text-black"}`,children:[s.jsx("p",{className:"text-sm",children:e.message}),s.jsx("span",{className:"text-xs opacity-80 mt-1 block text-right",children:new Date(e.created_at).toLocaleTimeString()})]}),e.sender_id===o.user.id&&s.jsx("button",{onClick:()=>j(e.id),className:"ml-2 text-red-500",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z",clipRule:"evenodd"})})})]},e.id||a))}),s.jsx("div",{className:"p-4 border-t border-gray-200",children:s.jsxs("form",{onSubmit:w,className:"flex items-center",children:[s.jsx("input",{type:"text",value:d,onChange:e=>x(e.target.value),className:"flex-1 p-3 border border-gray-200 rounded-full px-5 dark:bg-darkSecondary dark:border-dark ",placeholder:"Type a message..."}),s.jsx("button",{type:"submit",className:"ml-3 px-6 py-3 bg-primary text-white rounded-full hover:bg-opacity-80 disabled:bg-opacity-50 transition-colors",disabled:!d.trim()||!t,children:"Send"})]})})]}):s.jsx("div",{className:"flex-1 flex items-center justify-center text-gray-400 text-lg",children:"Select a contact to start chatting"})})]}),s.jsx(_,{isOpen:y,onClose:h,onConfirm:v,title:"Delete Message",message:"Are you sure you want to delete this message?",confirmText:"Yes, Delete",cancelText:"Cancel",confirmColor:"bg-red-600"})]})})};export{T as default};
